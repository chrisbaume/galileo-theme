---
layout: post
title: Raspberry Pi UPnP media player
date: 2012-06-24 18:45:25.000000000 +01:00
type: post
comments: true
published: true
status: publish
categories:
- Raspberry Pi
tags: []
meta:
  _edit_last: '5947599'
  _oembed_aee2a19fc360f63563df5e03aed6214a: "{{unknown}}"
  _oembed_b44c8f2c800ad76d248fd9a6714566e6: "{{unknown}}"
  _oembed_c3e9588a6162bdfdca9b8ad27fe64856: "{{unknown}}"
  _oembed_05502fffe438b30d45fdcf32a806a91f: "{{unknown}}"
  _oembed_7d20cd7ddecfd4a5c982427dd04f05ca: "{{unknown}}"
  _oembed_d9811bb026363c4bdd493003bff8b3a9: "{{unknown}}"
  _oembed_82672bf79e2d23882f8b3cfc69c23160: "{{unknown}}"
  _oembed_d76ed777d09be0bb7d67335d64ffea74: "{{unknown}}"
  _oembed_edd0f21576139f5362d20aac3adcda33: "{{unknown}}"
  _oembed_d62bb4ee9caf8016cc91a15b2e1650b2: "{{unknown}}"
  _oembed_a8766fe2d80163686f3b287557a16482: "{{unknown}}"
  _oembed_4de283f2b7701e11d114dad9f7d353b7: "{{unknown}}"
  _oembed_77e5a092c6946a4d93707057bf55c4c6: "{{unknown}}"
  _oembed_e8bbb5bbdd0ba000a2b9f546aed34842: "{{unknown}}"
  _oembed_1483fc2ba6d5ee4e0bab38f34938be38: "{{unknown}}"
  _oembed_d07032dfddc4ec375a7c942dbe3f45ce: "{{unknown}}"
  _oembed_e2d5d68b50ff1673c30c465686cf73e9: "{{unknown}}"
  _oembed_cb58fb7823bd6cd2ecdabde5b4553d39: "{{unknown}}"
  _oembed_19a6d2abda1c5b25c74f81bae4589815: "{{unknown}}"
  _oembed_5ca0bf49113fc832fae9115d9e03aede: "{{unknown}}"
  _oembed_3e8491eef02720e1d4bf44ea1b8664cf: "{{unknown}}"
  _oembed_0a8071c18a6bb0929b3528b53f1c150d: "{{unknown}}"
  _oembed_1de0de6ba64994604e51fa3763881bc0: "{{unknown}}"
  _oembed_3262b3a8d2df0a8739c7fc738c8ddd60: "{{unknown}}"
  _oembed_7c5b256d34d612aef9947a816c3e1024: "{{unknown}}"
  _oembed_67fd5fd71328d1bcf3dd80ba72abfa64: "{{unknown}}"
  _oembed_f81f6807ccb75ab1168756d6982e706d: "{{unknown}}"
  _oembed_be78d4015afd01ab81276b365431e7cc: "{{unknown}}"
  _oembed_adf25a72ec0bdff03299ac9f5568cab0: "{{unknown}}"
  _oembed_26c9655d39725713d82fc5178aee66ef: "{{unknown}}"
  _oembed_6013c5033650ce98caf02fe7d9a10f64: "{{unknown}}"
  _oembed_83bd2de451f6b1fde4c7bf0337faeac7: "{{unknown}}"
  _oembed_6d768dc3fc30410f369491d800f1139b: "{{unknown}}"
  _oembed_21550c9eaa3edee05c4459e8461ce664: "{{unknown}}"
  _oembed_12625377325d9841ee727fd42b69aa5e: "{{unknown}}"
  _oembed_3c970c4c67f715347c8d194f5be5389b: "{{unknown}}"
  _oembed_7fa645814c0423ca0ee64bec76dbb915: "{{unknown}}"
  _oembed_fa8414c9149c95771af1a389b9524a3d: "{{unknown}}"
  _oembed_b17da53486c1711309ee661b8dc77767: "{{unknown}}"
  _oembed_5b06081800c87c48e278b4e1f22fcc7d: "{{unknown}}"
  _oembed_eaad6120c4910dba6717275b3128216d: "{{unknown}}"
  _oembed_64b4afb85cfcfe94f02f54da4d91f33c: "{{unknown}}"
  _oembed_0baf1dba5356c93d9720a1c22c7115a8: "{{unknown}}"
  _oembed_8e85c21e63c2ecf842a62b92ad8d8132: "{{unknown}}"
  _oembed_76855e3a7fc6a2809dc91aa9c1853da5: "{{unknown}}"
  _oembed_dbb45fe5438d289a638eae91f996546e: "{{unknown}}"
  _oembed_11a50a949217465d011a01c271e65186: "{{unknown}}"
  _oembed_1a6981a8c34ab9590b477138f95d63e2: "{{unknown}}"
  _oembed_7c428e7b7a537a7c6945caaf42390887: "{{unknown}}"
  _oembed_5c4c62f0eba3418f92181125d1cceb36: "{{unknown}}"
  _oembed_cdac0d2e172ccad8c18e23d429daf1ab: "{{unknown}}"
  _oembed_09ce07340bc4a3f5056f5e65210f606b: "{{unknown}}"
  _oembed_c056d8a4fd492f8d2d1806ca4a79f13a: "{{unknown}}"
  _oembed_f3749f99467c8ef8be7629833c9ee3d7: "{{unknown}}"
  _oembed_5e0a4636964887d6e2c1667f6a062571: "{{unknown}}"
  _oembed_66e4620d2d66b5e92244209131f2c93d: "{{unknown}}"
  _oembed_9eb62567b3c201afd68ed8e42957d90b: "{{unknown}}"
  _oembed_104b91e4518ad91133ebf3eeee3a14a0: "{{unknown}}"
  _oembed_82dae5402e3f0f8143a1ed73a09137b1: "{{unknown}}"
author:
  login: chrisbaume
  email: chrisbaume@gmail.com
  display_name: chrisbaume
  first_name: ''
  last_name: ''
---
My immediate thought of what to do with my RPi was to set it up so that I could stream audio to the kitchen. I wanted
to be able to listen to my music collection (stored on an [XBMC](https://kodi.tv/about/) server) and podcasts (from my
phone), and be able to control everything from my phone. I achieved this by setting up the RPi as a UPnP media
renderer, with XBMC as the UPnP media server and my phone as the UPnP control point (and media server). It runs the
very minimal [GMediaRender](http://gmrender.nongnu.org/) on the RPi [Debian
image](http://www.raspberrypi.org/downloads). Below is a little tutorial on how I did it:

## Packages

Firstly, install all the required software:

{% highlight shell %}
sudo apt-get install alsa-base alsa-tools alsa-utils gstreamer0.10-alsa \
gstreamer0.10-ffmpeg gstreamer0.10-fluendo-mp3 gstreamer0.10-plugins-base \
libgstreamer-plugins-base0.10-0 libgstreamer0.10-0 libgstreamer0.10-dev \
gstreamer0.10-plugins-good gstreamer0.10-tools libupnp-dev automake cvs
{% endhighlight %}

## ALSA setup

Make sure that the username you’re using has permission to access the sound card:

{% highlight shell %}
sudo useradd -G audio <username>
{% endhighlight %}

To enable the sound card, you need to add the following line to /etc/modules:

{% highlight shell %}
snd_bcm2835
{% endhighlight %}

After you do that, reboot the machine so that the module is loaded:

{% highlight shell %}
sudo reboot
{% endhighlight %}

To make sure that ALSA is working, list the devices:

{% highlight shell %}
aplay -l
{% endhighlight %}

You should see something like this:

{% highlight shell %}
card 0: ALSA [bcm2835 ALSA], device 0: bcm2835 ALSA [bcm2835 ALSA]
{% endhighlight %}

If you want to use the headphone socket instead of audio over HDMI, you’ll need to change the setting:

{% highlight shell %}
sudo amixer cset numid=3 1
{% endhighlight %}

Finally – to check the sound is working – run the speaker test:

{% highlight shell %}
speaker-test
{% endhighlight %}

## GMediaRender setup

<span class="color:red">EDIT: As the GMediaRender project appears to be dormant and have some missing features, [Henner
Zeller](https://github.com/hzeller) has resurrected it back into life in the form of
[GMediaRender-resurrect](https://github.com/hzeller/gmrender-resurrect). You’re probably better off using his code
instead.</span>

You’ll want to use the very latest version of GMediaRender, which can be downloaded from
[here](http://savannah.nongnu.org/projects/gmrender/) using CVS:

{% highlight shell %}
cvs -d:pserver:anonymous@cvs.sv.gnu.org:/sources/gmrender co .
{% endhighlight %}

Once that downloads, run the following commands to compile and install the program:

{% highlight shell %}
cd gmrender
./autogen.sh
./configure
make
sudo make install
{% endhighlight %}

Now, for the moment of truth, navigate to your home directory and launch the program:

{% highlight shell %}
gmediarender -f "Raspberry Pi"
{% endhighlight %}

You should be able to use any UPnP control point (such as
[BubbleUPnP](https://play.google.com/store/apps/details?id=com.bubblesoft.android.bubbleupnp&hl=en)) to send audio from
a UPnP media server (like [XBMC](http://xbmc.org/about/)) to your RPi.


## Launch on boot

I’ve been trying to set it up so that GMediaRender launches on boot so that I don’t have to log in every time. None of
the techniques I’ve tried so far (crontab @reboot, /etc/rc.local, .bashrc) have worked, so any suggestions are welcome.

__EDIT:__ [@MJFComputerServ](http://twitter.com/#!/MJFComputerServ) has kindly pointed me towards
[this](http://elinux.org/RPi_VNC_Server) article which explains how to write a /etc/init.d script to launch a program.

Do do this for GMediaRender, copy the following to /etc/init.d/gmediarender

{% highlight shell %}
### BEGIN INIT INFO
# Provides: gmediarender
# Required-Start: $remote_fs $syslog
# Required-Stop: $remote_fs $syslog
# Default-Start: 2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: Start GMediaRender at boot time
# Description: Start GMediaRender at boot time.
### END INIT INFO
#! /bin/sh
# /etc/init.d/gmediarender
USER=root
HOME=/root
export USER HOME
case "$1" in
 start)
 echo "Starting GMediaRender"
 /usr/local/bin/gmediarender -f "Raspberry Pi"
 ;;
stop)
 echo "Stopping GMediaRender"
 killall gmediarender
 ;;
*)
 echo "Usage: /etc/init.d/gmediarender {start|stop}"
 exit 1
 ;;
esac
exit 0
{% endhighlight %}

Make the file executable:

{% highlight shell %}
sudo chmod 755 /etc/init.d/gmediarender
{% endhighlight %}

And configure the system to run it on startup:

{% highlight shell %}
sudo update-rc.d gmediarender defaults
{% endhighlight %}

Works for me – let me know how you get on!
